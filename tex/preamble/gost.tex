\documentclass[
  russian, utf8, 12pt,
  nocolumnsxix, nocolumnxxxi, nocolumnxxxii,
  hpadding = 5mm]
{eskdtext}



% Typography

%% Enable typography stuff
\usepackage[no-math]{fontspec}
\defaultfontfeatures{Mapping = tex-text}

%% Enable math
\usepackage{amsmath}
\usepackage{mathtext}

%% Use nice fractions
\usepackage{nicefrac}

%% Cyrillic special for ESKD
%% Also ESKD uses Babel, so no Polyglossia here
\usepackage{xecyr}



% Fonts

\setmainfont{CMU Serif}
\setsansfont{CMU Sans Serif}
\setmonofont{CMU Typewriter Text}

%% Remove Italic everywhere in ESKDX
\renewcommand{\ESKDfontShape}{\sffamily\itshape}



% Page setup

%% Use contents
\usepackage{titletoc}

%% Show only sections and subsections in TOC
\setcounter{tocdepth}{2}

% Set line spacing
\usepackage{setspace}
\setstretch{1.1}

% Enable first indention in section
\usepackage{indentfirst}
\parindent = 2em

%% Adjust sections, paragraphs styles and vertical margins

\ESKDsectSkip{section}{3.5ex}{3.0ex}
\ESKDsectSkip{subsection}{2.5ex}{2.5ex}
\ESKDsectSkip{subsubsection}{2.5ex}{2.5ex}

\ESKDsectStyle{section}{\Large\bfseries\uppercase}
\ESKDsectStyle{subsection}{\Large\bfseries}
\ESKDsectStyle{subsubsection}{\large\bfseries}

\makeatletter
\renewcommand\paragraph{
  \@startsection{subparagraph}{4}{\parindent}
    {2.5ex}{2.5ex}
    {\normalfont\normalsize\bfseries}}
\makeatother

\makeatletter
\renewcommand\subparagraph{
  \@startsection{subparagraph}{5}{\parindent}
    {2.5ex}{2.5ex}
    {\normalfont\small\bfseries}}
\makeatother

%% Start every section from new page
\let\stdsection\section
\renewcommand\section{\clearpage\stdsection}



% Colors

\usepackage{xcolor}

%% Tango color palette

\definecolor{LightButter}{HTML}{FCE94F}
\definecolor{Butter}{HTML}{EDD400}
\definecolor{DarkButter}{HTML}{C4A000}

\definecolor{LightOrange}{HTML}{FCAF3E}
\definecolor{Orange}{HTML}{F57900}
\definecolor{DarkOrange}{HTML}{CE5C00}

\definecolor{LightChocolate}{HTML}{e9b96e}
\definecolor{Chocolate}{HTML}{C17D11}
\definecolor{DarkChocolate}{HTML}{8F5902}

\definecolor{LightChameleon}{HTML}{8AE234}
\definecolor{Chameleon}{HTML}{73D216}
\definecolor{DarkChameleon}{HTML}{4E9A06}

\definecolor{LightSkyBlue}{HTML}{729FCF}
\definecolor{SkyBlue}{HTML}{3465A4}
\definecolor{DarkSkyBlue}{HTML}{204A87}

\definecolor{LightPlum}{HTML}{AD7FA8}
\definecolor{Plum}{HTML}{75507B}
\definecolor{DarkPlum}{HTML}{5C3566}

\definecolor{LightScarletRed}{HTML}{EF2929}
\definecolor{ScarletRed}{HTML}{CC0000}
\definecolor{DarkScarletRed}{HTML}{A40000}

\definecolor{Aluminium1}{HTML}{EEEEEC}
\definecolor{Aluminium2}{HTML}{D3D7CF}
\definecolor{Aluminium3}{HTML}{BABDB6}
\definecolor{Aluminium4}{HTML}{888A85}
\definecolor{Aluminium5}{HTML}{555753}
\definecolor{Aluminium6}{HTML}{2e3436}



% PDF configuration

%% * breaklinks — allow links to break across lines
%% * xetex — backend sign
%% * bookmarks — provide PDF bookmarks
\usepackage[breaklinks, xetex, bookmarks]{hyperref}

%% * linkcolor — local links
%% * citecolor — citations
%% * urlcolor — URLs
\hypersetup {
  colorlinks,
  linkcolor = DarkSkyBlue,
  citecolor = DarkSkyBlue,
  urlcolor = DarkSkyBlue,
}

%% PDF information
\hypersetup {
  pdfauthor = {Дрёмов Артур},
  pdfcreator = {XeTeX}
}

%% Don’t use Mono font for URLs
\urlstyle{same}



% Tables

%% Use long tables
\usepackage{longtable}

%% Table alignment
\usepackage{tabularx}
\newcolumntype{L}{>{\raggedright\arraybackslash}X}
\newcolumntype{P}[1]{>{\raggedright\arraybackslash}p{#1}}



% Other options

%% Provide PDF files inserting
\usepackage[final]{pdfpages}

%% GOST UTF-8 custom style for listing literature
\bibliographystyle{utf8gost71u}



% Custom commands

%% Term
\newcommand{\term}{\textit}

%% Expression
\newcommand{\expr}{\textit}

%% File system
\newcommand{\fs}{\textit}

%% Code
\newcommand{\code}{\texttt}

%% Inline code
\usepackage{minted}
\newminted[inlinecode]{text}{fontsize=\footnotesize}

%% Source code from file
\usemintedstyle{tango}
\newcommand{\source}[2]
{
  \inputminted[
    frame = single,
    linenos,
    numbersep = -12pt,
    framesep = 20pt,
    tabsize = 2,
    fontsize = \footnotesize
  ]{#1}{#2}
}

%% Image
\usepackage{graphicx}
\newcommand{\image}[2][1]
{
  \begin{center}
    \includegraphics[width = #1\textwidth]{#2}
  \end{center}
}



% ESKDX hacks

%% Make font used in main inscription smaller
\renewcommand{\ESKDfontVII}{\ESKDfontV}

%% Remove name of appendix from top of the page, it will be in inscription
\makeatletter
\renewcommand{\ESKDappendix}[2]{
  \ESKDclearDoublePage
  \refstepcounter{appendix}
  \setcounter{point}{0}
  \ifESKD@point@style@single
    \renewcommand{\thepoint}{\theappendix.\arabic{point}}
  \fi
  \setcounter{section}{0}
  \renewcommand{\thesection}{\theappendix.\arabic{section}}
  \setcounter{equation}{0}
  \renewcommand{\theequation}{\theappendix.\arabic{equation}}
  \setcounter{figure}{0}
  \renewcommand{\thefigure}{\theappendix.\arabic{figure}}
  \setcounter{table}{0}
  \renewcommand{\thetable}{\theappendix.\arabic{table}}
  \addcontentsline{toc}{section}{\appendixname\ \theappendix\ #2}
  \begin{list}{}{
    \setlength{\itemindent}{0mm}
    \setlength{\labelwidth}{0mm}
    \setlength{\labelsep}{0mm}
    \setlength{\leftmargin}{0mm}
    \setlength{\topsep}{0mm}
    \setlength{\parskip}{0mm}
    \setlength{\partopsep}{0mm}
    \setlength{\itemsep}{0mm}
    \setlength{\parsep}{0mm}}
    \item\centering\appendixname\ \theappendix
    \ifx#1\@empty\else\\(#1)\fi\\
  \end{list}%
  \par\nobreak\addvspace{\ESKDappendixSkip}}
\makeatother

%% Appendix configuration: main inscription is second GOST form,
%% place appendix name in inscription
\let\ESKDappendixOld\ESKDappendix
\renewcommand{\ESKDappendix}[2]
{
  \ESKDappendixOld{#1}{#2}
  \ESKDthisStyle{formII}
  \ESKDcolumnI{#2}
}
